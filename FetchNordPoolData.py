#   *********************************************************************
#   *                                                                   *
#   *   Function:       get_nordpool_prices                             *
#   *   Description:    Get 'DayAhead' data from NordPool for today     *
#   *                   in Euro's for Netherlands                       *
#   *   Author:         Danny Oldenhave                                 *
#   *   Used within:    ToCoolOrNotToCool                               *
#   *   Dependancies:   requests, json, datetime                        *
#   *                                                                   *
#   *********************************************************************


import requests, json
from datetime import date

BACKUPDATA: dict = json.dumps(
        # Hourly backup data
        #{"backup": True, "deliveryDateCET": "2024-12-10", "version": 2, "updatedAt": "2024-12-09T11:55:38.4137827Z", "deliveryAreas": ["NL"], "market": "DayAhead", "multiAreaEntries": [{"deliveryStart": "2024-12-09T23:00:00Z", "deliveryEnd": "2024-12-10T00:00:00Z", "entryPerArea": {"NL": 77.27}}, {"deliveryStart": "2024-12-10T00:00:00Z", "deliveryEnd": "2024-12-10T01:00:00Z", "entryPerArea": {"NL": 85.0}}, {"deliveryStart": "2024-12-10T01:00:00Z", "deliveryEnd": "2024-12-10T02:00:00Z", "entryPerArea": {"NL": 84.93}}, {"deliveryStart": "2024-12-10T02:00:00Z", "deliveryEnd": "2024-12-10T03:00:00Z", "entryPerArea": {"NL": 83.7}}, {"deliveryStart": "2024-12-10T03:00:00Z", "deliveryEnd": "2024-12-10T04:00:00Z", "entryPerArea": {"NL": 87.21}}, {"deliveryStart": "2024-12-10T04:00:00Z", "deliveryEnd": "2024-12-10T05:00:00Z", "entryPerArea": {"NL": 87.69}}, {"deliveryStart": "2024-12-10T05:00:00Z", "deliveryEnd": "2024-12-10T06:00:00Z", "entryPerArea": {"NL": 100.0}}, {"deliveryStart": "2024-12-10T06:00:00Z", "deliveryEnd": "2024-12-10T07:00:00Z", "entryPerArea": {"NL": 112.79}}, {"deliveryStart": "2024-12-10T07:00:00Z", "deliveryEnd": "2024-12-10T08:00:00Z", "entryPerArea": {"NL": 134.23}}, {"deliveryStart": "2024-12-10T08:00:00Z", "deliveryEnd": "2024-12-10T09:00:00Z", "entryPerArea": {"NL": 157.73}}, {"deliveryStart": "2024-12-10T09:00:00Z", "deliveryEnd": "2024-12-10T10:00:00Z", "entryPerArea": {"NL": 153.13}}, {"deliveryStart": "2024-12-10T10:00:00Z", "deliveryEnd": "2024-12-10T11:00:00Z", "entryPerArea": {"NL": 163.0}}, {"deliveryStart": "2024-12-10T11:00:00Z", "deliveryEnd": "2024-12-10T12:00:00Z", "entryPerArea": {"NL": 135.22}}, {"deliveryStart": "2024-12-10T12:00:00Z", "deliveryEnd": "2024-12-10T13:00:00Z", "entryPerArea": {"NL": 169.15}}, {"deliveryStart": "2024-12-10T13:00:00Z", "deliveryEnd": "2024-12-10T14:00:00Z", "entryPerArea": {"NL": 169.48}}, {"deliveryStart": "2024-12-10T14:00:00Z", "deliveryEnd": "2024-12-10T15:00:00Z", "entryPerArea": {"NL": 176.6}}, {"deliveryStart": "2024-12-10T15:00:00Z", "deliveryEnd": "2024-12-10T16:00:00Z", "entryPerArea": {"NL": 179.97}}, {"deliveryStart": "2024-12-10T16:00:00Z", "deliveryEnd": "2024-12-10T17:00:00Z", "entryPerArea": {"NL": 159.9}}, {"deliveryStart": "2024-12-10T17:00:00Z", "deliveryEnd": "2024-12-10T18:00:00Z", "entryPerArea": {"NL": 181.0}}, {"deliveryStart": "2024-12-10T18:00:00Z", "deliveryEnd": "2024-12-10T19:00:00Z", "entryPerArea": {"NL": 176.65}}, {"deliveryStart": "2024-12-10T19:00:00Z", "deliveryEnd": "2024-12-10T20:00:00Z", "entryPerArea": {"NL": 151.98}}, {"deliveryStart": "2024-12-10T20:00:00Z", "deliveryEnd": "2024-12-10T21:00:00Z", "entryPerArea": {"NL": 120.0}}, {"deliveryStart": "2024-12-10T21:00:00Z", "deliveryEnd": "2024-12-10T22:00:00Z", "entryPerArea": {"NL": 107.2}}, {"deliveryStart": "2024-12-10T22:00:00Z", "deliveryEnd": "2024-12-10T23:00:00Z", "entryPerArea": {"NL": 121.37}}], "blockPriceAggregates": [{"blockName": "Off-peak 1", "deliveryStart": "2024-12-09T23:00:00Z", "deliveryEnd": "2024-12-10T07:00:00Z", "averagePricePerArea": {"NL": {"average": 89.82, "min": 77.27, "max": 112.79}}}, {"blockName": "Peak", "deliveryStart": "2024-12-10T07:00:00Z", "deliveryEnd": "2024-12-10T19:00:00Z", "averagePricePerArea": {"NL": {"average": 163.01, "min": 134.23, "max": 181.0}}}, {"blockName": "Off-peak 2", "deliveryStart": "2024-12-10T19:00:00Z", "deliveryEnd": "2024-12-10T23:00:00Z", "averagePricePerArea": {"NL": {"average": 125.14, "min": 107.2, "max": 151.98}}}], "currency": "EUR", "exchangeRate": 1, "areaStates": [{"state": "Final", "areas": ["NL"]}], "areaAverages": [{"areaCode": "NL", "price": 132.3}]}

        # 15 minutes backup data
        {"backup": True, "deliveryDateCET": "2025-10-08", "version": 2, "updatedAt": "2025-10-07T11:59:57.5628533Z", "deliveryAreas": ["NL"], "market": "DayAhead", "multiAreaEntries": [{"deliveryStart": "2025-10-07T22:00:00Z", "deliveryEnd": "2025-10-07T22:15:00Z", "entryPerArea": {"NL": 101.74}}, {"deliveryStart": "2025-10-07T22:15:00Z", "deliveryEnd": "2025-10-07T22:30:00Z", "entryPerArea": {"NL": 91.4}}, {"deliveryStart": "2025-10-07T22:30:00Z", "deliveryEnd": "2025-10-07T22:45:00Z", "entryPerArea": {"NL": 91.47}}, {"deliveryStart": "2025-10-07T22:45:00Z", "deliveryEnd": "2025-10-07T23:00:00Z", "entryPerArea": {"NL": 89.2}}, {"deliveryStart": "2025-10-07T23:00:00Z", "deliveryEnd": "2025-10-07T23:15:00Z", "entryPerArea": {"NL": 91.85}}, {"deliveryStart": "2025-10-07T23:15:00Z", "deliveryEnd": "2025-10-07T23:30:00Z", "entryPerArea": {"NL": 89.07}}, {"deliveryStart": "2025-10-07T23:30:00Z", "deliveryEnd": "2025-10-07T23:45:00Z", "entryPerArea": {"NL": 87.33}}, {"deliveryStart": "2025-10-07T23:45:00Z", "deliveryEnd": "2025-10-08T00:00:00Z", "entryPerArea": {"NL": 85.5}}, {"deliveryStart": "2025-10-08T00:00:00Z", "deliveryEnd": "2025-10-08T00:15:00Z", "entryPerArea": {"NL": 89.21}}, {"deliveryStart": "2025-10-08T00:15:00Z", "deliveryEnd": "2025-10-08T00:30:00Z", "entryPerArea": {"NL": 88.14}}, {"deliveryStart": "2025-10-08T00:30:00Z", "deliveryEnd": "2025-10-08T00:45:00Z", "entryPerArea": {"NL": 86.99}}, {"deliveryStart": "2025-10-08T00:45:00Z", "deliveryEnd": "2025-10-08T01:00:00Z", "entryPerArea": {"NL": 85.9}}, {"deliveryStart": "2025-10-08T01:00:00Z", "deliveryEnd": "2025-10-08T01:15:00Z", "entryPerArea": {"NL": 86.71}}, {"deliveryStart": "2025-10-08T01:15:00Z", "deliveryEnd": "2025-10-08T01:30:00Z", "entryPerArea": {"NL": 84.17}}, {"deliveryStart": "2025-10-08T01:30:00Z", "deliveryEnd": "2025-10-08T01:45:00Z", "entryPerArea": {"NL": 86.98}}, {"deliveryStart": "2025-10-08T01:45:00Z", "deliveryEnd": "2025-10-08T02:00:00Z", "entryPerArea": {"NL": 86.17}}, {"deliveryStart": "2025-10-08T02:00:00Z", "deliveryEnd": "2025-10-08T02:15:00Z", "entryPerArea": {"NL": 85.66}}, {"deliveryStart": "2025-10-08T02:15:00Z", "deliveryEnd": "2025-10-08T02:30:00Z", "entryPerArea": {"NL": 84.48}}, {"deliveryStart": "2025-10-08T02:30:00Z", "deliveryEnd": "2025-10-08T02:45:00Z", "entryPerArea": {"NL": 87.11}}, {"deliveryStart": "2025-10-08T02:45:00Z", "deliveryEnd": "2025-10-08T03:00:00Z", "entryPerArea": {"NL": 91.67}}, {"deliveryStart": "2025-10-08T03:00:00Z", "deliveryEnd": "2025-10-08T03:15:00Z", "entryPerArea": {"NL": 86.98}}, {"deliveryStart": "2025-10-08T03:15:00Z", "deliveryEnd": "2025-10-08T03:30:00Z", "entryPerArea": {"NL": 93.28}}, {"deliveryStart": "2025-10-08T03:30:00Z", "deliveryEnd": "2025-10-08T03:45:00Z", "entryPerArea": {"NL": 92.51}}, {"deliveryStart": "2025-10-08T03:45:00Z", "deliveryEnd": "2025-10-08T04:00:00Z", "entryPerArea": {"NL": 102.9}}, {"deliveryStart": "2025-10-08T04:00:00Z", "deliveryEnd": "2025-10-08T04:15:00Z", "entryPerArea": {"NL": 92.99}}, {"deliveryStart": "2025-10-08T04:15:00Z", "deliveryEnd": "2025-10-08T04:30:00Z", "entryPerArea": {"NL": 108.63}}, {"deliveryStart": "2025-10-08T04:30:00Z", "deliveryEnd": "2025-10-08T04:45:00Z", "entryPerArea": {"NL": 120.42}}, {"deliveryStart": "2025-10-08T04:45:00Z", "deliveryEnd": "2025-10-08T05:00:00Z", "entryPerArea": {"NL": 134.53}}, {"deliveryStart": "2025-10-08T05:00:00Z", "deliveryEnd": "2025-10-08T05:15:00Z", "entryPerArea": {"NL": 127.56}}, {"deliveryStart": "2025-10-08T05:15:00Z", "deliveryEnd": "2025-10-08T05:30:00Z", "entryPerArea": {"NL": 148.39}}, {"deliveryStart": "2025-10-08T05:30:00Z", "deliveryEnd": "2025-10-08T05:45:00Z", "entryPerArea": {"NL": 165.45}}, {"deliveryStart": "2025-10-08T05:45:00Z", "deliveryEnd": "2025-10-08T06:00:00Z", "entryPerArea": {"NL": 168.83}}, {"deliveryStart": "2025-10-08T06:00:00Z", "deliveryEnd": "2025-10-08T06:15:00Z", "entryPerArea": {"NL": 203.62}}, {"deliveryStart": "2025-10-08T06:15:00Z", "deliveryEnd": "2025-10-08T06:30:00Z", "entryPerArea": {"NL": 175.34}}, {"deliveryStart": "2025-10-08T06:30:00Z", "deliveryEnd": "2025-10-08T06:45:00Z", "entryPerArea": {"NL": 151.24}}, {"deliveryStart": "2025-10-08T06:45:00Z", "deliveryEnd": "2025-10-08T07:00:00Z", "entryPerArea": {"NL": 135.38}}, {"deliveryStart": "2025-10-08T07:00:00Z", "deliveryEnd": "2025-10-08T07:15:00Z", "entryPerArea": {"NL": 176.35}}, {"deliveryStart": "2025-10-08T07:15:00Z", "deliveryEnd": "2025-10-08T07:30:00Z", "entryPerArea": {"NL": 142.45}}, {"deliveryStart": "2025-10-08T07:30:00Z", "deliveryEnd": "2025-10-08T07:45:00Z", "entryPerArea": {"NL": 119.67}}, {"deliveryStart": "2025-10-08T07:45:00Z", "deliveryEnd": "2025-10-08T08:00:00Z", "entryPerArea": {"NL": 106.06}}, {"deliveryStart": "2025-10-08T08:00:00Z", "deliveryEnd": "2025-10-08T08:15:00Z", "entryPerArea": {"NL": 139.21}}, {"deliveryStart": "2025-10-08T08:15:00Z", "deliveryEnd": "2025-10-08T08:30:00Z", "entryPerArea": {"NL": 119.74}}, {"deliveryStart": "2025-10-08T08:30:00Z", "deliveryEnd": "2025-10-08T08:45:00Z", "entryPerArea": {"NL": 106.31}}, {"deliveryStart": "2025-10-08T08:45:00Z", "deliveryEnd": "2025-10-08T09:00:00Z", "entryPerArea": {"NL": 99.46}}, {"deliveryStart": "2025-10-08T09:00:00Z", "deliveryEnd": "2025-10-08T09:15:00Z", "entryPerArea": {"NL": 120.14}}, {"deliveryStart": "2025-10-08T09:15:00Z", "deliveryEnd": "2025-10-08T09:30:00Z", "entryPerArea": {"NL": 101.96}}, {"deliveryStart": "2025-10-08T09:30:00Z", "deliveryEnd": "2025-10-08T09:45:00Z", "entryPerArea": {"NL": 94.05}}, {"deliveryStart": "2025-10-08T09:45:00Z", "deliveryEnd": "2025-10-08T10:00:00Z", "entryPerArea": {"NL": 85.06}}, {"deliveryStart": "2025-10-08T10:00:00Z", "deliveryEnd": "2025-10-08T10:15:00Z", "entryPerArea": {"NL": 92.65}}, {"deliveryStart": "2025-10-08T10:15:00Z", "deliveryEnd": "2025-10-08T10:30:00Z", "entryPerArea": {"NL": 88.73}}, {"deliveryStart": "2025-10-08T10:30:00Z", "deliveryEnd": "2025-10-08T10:45:00Z", "entryPerArea": {"NL": 86.6}}, {"deliveryStart": "2025-10-08T10:45:00Z", "deliveryEnd": "2025-10-08T11:00:00Z", "entryPerArea": {"NL": 86.05}}, {"deliveryStart": "2025-10-08T11:00:00Z", "deliveryEnd": "2025-10-08T11:15:00Z", "entryPerArea": {"NL": 88.93}}, {"deliveryStart": "2025-10-08T11:15:00Z", "deliveryEnd": "2025-10-08T11:30:00Z", "entryPerArea": {"NL": 87.74}}, {"deliveryStart": "2025-10-08T11:30:00Z", "deliveryEnd": "2025-10-08T11:45:00Z", "entryPerArea": {"NL": 86.06}}, {"deliveryStart": "2025-10-08T11:45:00Z", "deliveryEnd": "2025-10-08T12:00:00Z", "entryPerArea": {"NL": 84.38}}, {"deliveryStart": "2025-10-08T12:00:00Z", "deliveryEnd": "2025-10-08T12:15:00Z", "entryPerArea": {"NL": 82.93}}, {"deliveryStart": "2025-10-08T12:15:00Z", "deliveryEnd": "2025-10-08T12:30:00Z", "entryPerArea": {"NL": 84.88}}, {"deliveryStart": "2025-10-08T12:30:00Z", "deliveryEnd": "2025-10-08T12:45:00Z", "entryPerArea": {"NL": 86.66}}, {"deliveryStart": "2025-10-08T12:45:00Z", "deliveryEnd": "2025-10-08T13:00:00Z", "entryPerArea": {"NL": 94.46}}, {"deliveryStart": "2025-10-08T13:00:00Z", "deliveryEnd": "2025-10-08T13:15:00Z", "entryPerArea": {"NL": 84.27}}, {"deliveryStart": "2025-10-08T13:15:00Z", "deliveryEnd": "2025-10-08T13:30:00Z", "entryPerArea": {"NL": 88.51}}, {"deliveryStart": "2025-10-08T13:30:00Z", "deliveryEnd": "2025-10-08T13:45:00Z", "entryPerArea": {"NL": 95.9}}, {"deliveryStart": "2025-10-08T13:45:00Z", "deliveryEnd": "2025-10-08T14:00:00Z", "entryPerArea": {"NL": 108.61}}, {"deliveryStart": "2025-10-08T14:00:00Z", "deliveryEnd": "2025-10-08T14:15:00Z", "entryPerArea": {"NL": 86.02}}, {"deliveryStart": "2025-10-08T14:15:00Z", "deliveryEnd": "2025-10-08T14:30:00Z", "entryPerArea": {"NL": 94.17}}, {"deliveryStart": "2025-10-08T14:30:00Z", "deliveryEnd": "2025-10-08T14:45:00Z", "entryPerArea": {"NL": 118.25}}, {"deliveryStart": "2025-10-08T14:45:00Z", "deliveryEnd": "2025-10-08T15:00:00Z", "entryPerArea": {"NL": 139.62}}, {"deliveryStart": "2025-10-08T15:00:00Z", "deliveryEnd": "2025-10-08T15:15:00Z", "entryPerArea": {"NL": 96.65}}, {"deliveryStart": "2025-10-08T15:15:00Z", "deliveryEnd": "2025-10-08T15:30:00Z", "entryPerArea": {"NL": 117.95}}, {"deliveryStart": "2025-10-08T15:30:00Z", "deliveryEnd": "2025-10-08T15:45:00Z", "entryPerArea": {"NL": 148.81}}, {"deliveryStart": "2025-10-08T15:45:00Z", "deliveryEnd": "2025-10-08T16:00:00Z", "entryPerArea": {"NL": 203.12}}, {"deliveryStart": "2025-10-08T16:00:00Z", "deliveryEnd": "2025-10-08T16:15:00Z", "entryPerArea": {"NL": 129.74}}, {"deliveryStart": "2025-10-08T16:15:00Z", "deliveryEnd": "2025-10-08T16:30:00Z", "entryPerArea": {"NL": 142.25}}, {"deliveryStart": "2025-10-08T16:30:00Z", "deliveryEnd": "2025-10-08T16:45:00Z", "entryPerArea": {"NL": 195.41}}, {"deliveryStart": "2025-10-08T16:45:00Z", "deliveryEnd": "2025-10-08T17:00:00Z", "entryPerArea": {"NL": 241.07}}, {"deliveryStart": "2025-10-08T17:00:00Z", "deliveryEnd": "2025-10-08T17:15:00Z", "entryPerArea": {"NL": 223.55}}, {"deliveryStart": "2025-10-08T17:15:00Z", "deliveryEnd": "2025-10-08T17:30:00Z", "entryPerArea": {"NL": 199.54}}, {"deliveryStart": "2025-10-08T17:30:00Z", "deliveryEnd": "2025-10-08T17:45:00Z", "entryPerArea": {"NL": 180.46}}, {"deliveryStart": "2025-10-08T17:45:00Z", "deliveryEnd": "2025-10-08T18:00:00Z", "entryPerArea": {"NL": 175.0}}, {"deliveryStart": "2025-10-08T18:00:00Z", "deliveryEnd": "2025-10-08T18:15:00Z", "entryPerArea": {"NL": 169.2}}, {"deliveryStart": "2025-10-08T18:15:00Z", "deliveryEnd": "2025-10-08T18:30:00Z", "entryPerArea": {"NL": 149.99}}, {"deliveryStart": "2025-10-08T18:30:00Z", "deliveryEnd": "2025-10-08T18:45:00Z", "entryPerArea": {"NL": 128.21}}, {"deliveryStart": "2025-10-08T18:45:00Z", "deliveryEnd": "2025-10-08T19:00:00Z", "entryPerArea": {"NL": 118.39}}, {"deliveryStart": "2025-10-08T19:00:00Z", "deliveryEnd": "2025-10-08T19:15:00Z", "entryPerArea": {"NL": 128.02}}, {"deliveryStart": "2025-10-08T19:15:00Z", "deliveryEnd": "2025-10-08T19:30:00Z", "entryPerArea": {"NL": 116.99}}, {"deliveryStart": "2025-10-08T19:30:00Z", "deliveryEnd": "2025-10-08T19:45:00Z", "entryPerArea": {"NL": 106.9}}, {"deliveryStart": "2025-10-08T19:45:00Z", "deliveryEnd": "2025-10-08T20:00:00Z", "entryPerArea": {"NL": 102.34}}, {"deliveryStart": "2025-10-08T20:00:00Z", "deliveryEnd": "2025-10-08T20:15:00Z", "entryPerArea": {"NL": 110.69}}, {"deliveryStart": "2025-10-08T20:15:00Z", "deliveryEnd": "2025-10-08T20:30:00Z", "entryPerArea": {"NL": 109.91}}, {"deliveryStart": "2025-10-08T20:30:00Z", "deliveryEnd": "2025-10-08T20:45:00Z", "entryPerArea": {"NL": 106.28}}, {"deliveryStart": "2025-10-08T20:45:00Z", "deliveryEnd": "2025-10-08T21:00:00Z", "entryPerArea": {"NL": 97.93}}, {"deliveryStart": "2025-10-08T21:00:00Z", "deliveryEnd": "2025-10-08T21:15:00Z", "entryPerArea": {"NL": 101.68}}, {"deliveryStart": "2025-10-08T21:15:00Z", "deliveryEnd": "2025-10-08T21:30:00Z", "entryPerArea": {"NL": 99.79}}, {"deliveryStart": "2025-10-08T21:30:00Z", "deliveryEnd": "2025-10-08T21:45:00Z", "entryPerArea": {"NL": 95.48}}, {"deliveryStart": "2025-10-08T21:45:00Z", "deliveryEnd": "2025-10-08T22:00:00Z", "entryPerArea": {"NL": 90.0}}], "blockPriceAggregates": [{"blockName": "Off-peak 1", "deliveryStart": "2025-10-07T22:00:00Z", "deliveryEnd": "2025-10-08T06:00:00Z", "averagePricePerArea": {"NL": {"average": 100.41, "min": 84.17, "max": 168.83}}}, {"blockName": "Peak", "deliveryStart": "2025-10-08T06:00:00Z", "deliveryEnd": "2025-10-08T18:00:00Z", "averagePricePerArea": {"NL": {"average": 124.9, "min": 82.93, "max": 241.07}}}, {"blockName": "Off-peak 2", "deliveryStart": "2025-10-08T18:00:00Z", "deliveryEnd": "2025-10-08T22:00:00Z", "averagePricePerArea": {"NL": {"average": 114.49, "min": 90.0, "max": 169.2}}}], "currency": "EUR", "exchangeRate": 1, "areaStates": [{"state": "Final", "areas": ["NL"]}], "areaAverages": [{"areaCode": "NL", "price": 115.0}], "backup": False}
    )

def get_nordpool_prices(debug: bool=False) -> dict:
    if not debug:
        url = "https://dataportal-api.nordpoolgroup.com/api/DayAheadPrices"
        dateParam = date.today()
        params = {
                    "currency": "EUR",
                    "market": "DayAhead",
                    "deliveryArea": "NL",
                    "date": dateParam                
                }

        try:
            response = requests.get(url, params=params)
            response.raise_for_status()
        except requests.exceptions.RequestException as e: # Nordpool Data unavailable, return BACKUPDATA dataset
            BACKUPDATA["e"] = e
            return json.loads(BACKUPDATA)

        data = response.json()
        data["backup"] = False
    else:
       return json.loads(BACKUPDATA)

    # Basic check if data is valid, otherwise return BACKUPDATA dataset
    if "areaAverages" not in data or "multiAreaEntries" not in data:
        BACKUPDATA["e"] = "Data from Nordpool was incomplete"
        return json.loads(BACKUPDATA)
    
    return data